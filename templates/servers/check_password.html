{% extends 'layout.html' %}

{% block title %}Проверка шифрования паролей серверов{% endblock %}

{% block content %}
<div class="container mt-4">
    <h1>Проверка шифрования паролей серверов</h1>
    
    <div class="alert alert-info">
        <p><strong>Информация:</strong> Эта страница показывает статус шифрования паролей серверов.</p>
        <p>Для безопасной работы автоматической проверки серверов по SSH необходимо использовать зашифрованные пароли.</p>
    </div>
    
    <div class="card mb-4">
        <div class="card-header">
            <h5 class="card-title mb-0">Общая статистика</h5>
        </div>
        <div class="card-body">
            <ul>
                <li>Всего серверов: <strong>{{ servers|length }}</strong></li>
                <li>Серверов с паролями: <strong>{{ servers_with_passwords|length }}</strong></li>
                <li>Серверов с ключами SSH: <strong>{{ servers_with_keys|length }}</strong></li>
                <li>Серверов с зашифрованными паролями: <strong>{{ servers_with_encrypted|length }}</strong></li>
            </ul>
        </div>
    </div>
    
    <h2>Список серверов</h2>
    
    <div class="table-responsive">
        <table class="table table-striped table-hover">
            <thead>
                <tr>
                    <th>Имя сервера</th>
                    <th>IP-адрес</th>
                    <th>Тип авторизации</th>
                    <th>Хеш пароля</th>
                    <th>Зашифрованный пароль</th>
                    <th>Статус</th>
                </tr>
            </thead>
            <tbody>
                {% for server in servers %}
                <tr>
                    <td>{{ server.name }}</td>
                    <td>{{ server.ip_address }}</td>
                    <td>
                        {% if server.ssh_key %}
                            <span class="badge bg-primary">SSH ключ</span>
                        {% elif server.ssh_password_hash %}
                            <span class="badge bg-warning text-dark">Пароль</span>
                        {% else %}
                            <span class="badge bg-danger">Не указан</span>
                        {% endif %}
                    </td>
                    <td>
                        {% if server.ssh_password_hash %}
                            <span class="badge bg-success">Установлен</span>
                        {% else %}
                            <span class="badge bg-secondary">Отсутствует</span>
                        {% endif %}
                    </td>
                    <td>
                        {% if server.ssh_encrypted_password %}
                            <span class="badge bg-success">Установлен</span>
                        {% else %}
                            <span class="badge bg-danger">Отсутствует</span>
                        {% endif %}
                    </td>
                    <td>
                        {% if server.ssh_key %}
                            <span class="badge bg-success">OK</span>
                        {% elif server.ssh_encrypted_password %}
                            <span class="badge bg-success">OK</span>
                        {% elif server.ssh_password_hash %}
                            <span class="badge bg-warning text-dark">Требуется шифрование</span>
                        {% else %}
                            <span class="badge bg-danger">Не настроен</span>
                        {% endif %}
                    </td>
                </tr>
                {% endfor %}
            </tbody>
        </table>
    </div>
    
    {% if errors %}
    <div class="alert alert-danger mt-4">
        <h4>Ошибки:</h4>
        <ul>
            {% for error in errors %}
            <li>{{ error }}</li>
            {% endfor %}
        </ul>
    </div>
    {% endif %}
    
    <div class="mt-4">
        <a href="/servers" class="btn btn-primary">Вернуться к списку серверов</a>
        <a href="/servers/migrate_passwords" class="btn btn-warning">Запустить миграцию паролей</a>
    </div>
</div>
{% endblock %}

{% block scripts %}
<script>
    document.addEventListener('DOMContentLoaded', function() {
        console.log('Страница проверки паролей загружена');
    });
</script>
{% endblock %}